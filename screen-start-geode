#!/bin/bash

#
# Tue Nov 29 18:09:58 PST 2016
# tweaked version http://dev-tricks.net/automating-gnu-screen-startup
#

SCREEN_SESSION="SCREEN - `date`"
SCREENS="l00k l00k runserver manage log console frontend l00k l00k l00k"
NUM=0

# start in daemon mode
screen -dmS "$SCREEN_SESSION"

for SCREEN_NAME in $(echo "${SCREENS}" ); do
    # create new window
    screen -S "${SCREEN_SESSION}" -p {$NUM} -X screen
    # name new window
    screen -S "${SCREEN_SESSION}" -p ${NUM} -X title ${SCREEN_NAME}
    # fix backspace/delete
    screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'. ~/bin/stty-keys\r'
    case "${NUM}" in
        "0")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            ;;
        "1")
            echo ${SCREEN_NAME}
            echo "l00k"
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            ;;
        "2")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'docker-compose run --rm --service-ports --use-aliases app\r'
            ;;
        "3")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'docker-compose run --rm app /bin/bash\r'
            ;;
        "4")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'tail -f log/development.log\r'
            ;;
        "5")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'docker-compose run --rm app rails c\r'
            ;;
        "6")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/frontend/\r'
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'gluestick start\r'
            ;;
        "7")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            ;;
        "8")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            ;;
        "9")
            echo ${SCREEN_NAME}
            screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'cd ~/workspace/src/geode/\r'
            ;;
        *)
            echo "Bad screen ${NUM}?"
            ;;
    esac
    NUM=$((NUM + 1))
done

# kill initial window (i.e. only keep explicitly created)
screen -S "${SCREEN_SESSION}" -p ${NUM} -X stuff $'exit\r'
echo "Now joining screen session ${SCREEN_SESSION}"
screen -x "${SCREEN_SESSION}"
